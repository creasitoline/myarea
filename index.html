<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>myArea - Digital Workspace</title>
    
    <link rel="icon" type="image/png" href="icon.png?v=2">
    <link rel="apple-touch-icon" href="icon.png?v=2">
    <link rel="manifest" href="manifest.json?v=2">
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://unpkg.com/html5-qrcode"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCn-hXY4R4xq18i3lToUsoTPOHSqgSkTnc",
            authDomain: "myarea-69ea3.firebaseapp.com",
            projectId: "myarea-69ea3",
            storageBucket: "myarea-69ea3.firebasestorage.app",
            messagingSenderId: "205977706737",
            appId: "1:205977706737:web:ae5aa9a14a7ac939a4c950"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let userData = { myLinks: [], myWork: [], myShopping: [] }; // Aggiunto myShopping
        let currentTab = 'tutti';
        let editIndex = null;
        let pressTimer;
        let searchTerm = "";
        
        let mediaRecorder;
        let audioChunks = [];
        let audioBase64 = null;
        let html5QrCode = null;

        const waIcon = "https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg";
        const callIcon = `<svg viewBox="0 0 24 24" fill="#007AFF"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>`;
        const trashSVG = `<svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>`;
        const editSVG = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7M18.5 2.5a2.121 2.121 0 113 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>`;

        async function loadData(uid) {
            const docRef = doc(db, "users", uid);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                const data = docSnap.data();
                userData = { ...userData, ...data };
                if(!userData.myShopping) userData.myShopping = [];
            } else { 
                await setDoc(docRef, userData); 
            }
            render();
        }

        async function syncCloud() {
            if (!currentUser) return;
            const docRef = doc(db, "users", currentUser.uid);
            await setDoc(docRef, userData);
        }

        window.handleAuth = async () => {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('passInput').value;
            try {
                await setPersistence(auth, browserLocalPersistence);
                await signInWithEmailAndPassword(auth, email, pass);
            } catch (e) { alert("Accesso fallito."); }
        };

        window.logout = () => signOut(auth);

        onAuthStateChanged(auth, (user) => {
            if (user) { 
                currentUser = user; 
                document.getElementById('welcomeScreen').style.display = 'none'; 
                document.getElementById('mainApp').style.display = 'flex'; 
                loadData(user.uid); 
            } else { 
                currentUser = null; 
                document.getElementById('welcomeScreen').style.display = 'flex'; 
                document.getElementById('mainApp').style.display = 'none'; 
            }
        });

        window.render = () => {
            const grid = document.getElementById('appGrid');
            const workContainer = document.getElementById('workContainer');
            const shoppingContainer = document.getElementById('shoppingContainer');
            const scannerView = document.getElementById('scannerView');
            const searchBar = document.getElementById('searchBarContainer');
            
            grid.innerHTML = ''; workContainer.innerHTML = ''; shoppingContainer.innerHTML = '';
            grid.style.display = 'none'; workContainer.style.display = 'none'; 
            shoppingContainer.style.display = 'none'; scannerView.style.display = 'none';
            searchBar.style.display = currentTab === 'cerca' ? 'block' : 'none';

            if(currentTab === 'lavoro') {
                workContainer.style.display = 'block';
                userData.myWork.forEach((w, i) => {
                    const div = document.createElement('div');
                    div.className = 'work-card';
                    div.innerHTML = `
                        <div class="work-info" onclick="editWork(${i})">
                            <h4>${w.client}</h4>
                            <p>${w.note}</p>
                            ${w.audio ? `<audio controls src="${w.audio}" class="custom-audio-player"></audio>` : ''}
                            <div class="work-meta">${w.date || '---'} â€¢ ${w.hours}h</div>
                        </div>
                        <div class="trash-btn" onclick="askDelete(${i}, 'work')">${trashSVG}</div>
                    `;
                    workContainer.appendChild(div);
                });
            } 
            else if(currentTab === 'spesa') {
                shoppingContainer.style.display = 'block';
                if(userData.myShopping.length === 0) shoppingContainer.innerHTML = '<p style="text-align:center; color:gray; margin-top:50px;">Nessun acquisto salvato.</p>';
                userData.myShopping.forEach((s, i) => {
                    const div = document.createElement('div');
                    div.className = 'work-card';
                    div.style.borderLeft = '5px solid var(--success)';
                    div.innerHTML = `
                        <div style="display:flex; gap:10px; align-items:center; width:100%">
                            <img src="${s.img}" style="width:50px; height:50px; object-fit:contain">
                            <div style="flex:1">
                                <h4 style="font-size:14px">${s.name}</h4>
                                <p style="font-size:12px; margin:2px 0">${s.shop} â€¢ ${s.date}</p>
                                <b style="color:var(--success)">â‚¬${parseFloat(s.price).toFixed(2)}</b>
                            </div>
                            <div class="trash-btn" onclick="askDelete(${i}, 'spesa')">${trashSVG}</div>
                        </div>
                    `;
                    shoppingContainer.appendChild(div);
                });
            }
            else if(currentTab === 'scanme') {
                scannerView.style.display = 'block';
                startScanner();
            }
            else {
                grid.style.display = 'grid';
                let filtered = userData.myLinks;
                if (currentTab === 'contatti') {
                    filtered = userData.myLinks.filter(l => l.category === 'contatti' || l.category === 'whatsapp');
                } else if (currentTab !== 'tutti' && currentTab !== 'cerca') {
                    filtered = userData.myLinks.filter(l => l.category === currentTab);
                }
                
                if (searchTerm !== "") {
                    filtered = filtered.filter(l => l.title.toLowerCase().includes(searchTerm));
                }
                
                filtered.forEach((l) => {
                    const idx = userData.myLinks.indexOf(l);
                    const div = document.createElement('div');
                    div.className = 'app-icon';
                    let icon = l.category === 'whatsapp' ? `<img src="${waIcon}">` : l.category === 'contatti' ? callIcon : `<img src="https://www.google.com/s2/favicons?sz=128&domain=${l.url}">`;
                    div.innerHTML = `<div class="context-menu" id="menu-${idx}"><div class="context-item" onclick="event.stopPropagation(); editLink(${idx})">${editSVG} Modifica</div><div class="context-item" style="color:var(--danger)" onclick="event.stopPropagation(); askDelete(${idx}, 'link')">${trashSVG} Elimina</div></div><div class="icon-box">${icon}</div><span class="app-name">${l.title}</span>`;
                    div.onclick = () => { if(document.getElementById(`menu-${idx}`).style.display === 'flex') { hideAllMenus(); return; } if (l.url.startsWith('tel:')) window.location.href = l.url; else window.open(l.url, '_blank'); };
                    div.onmousedown = div.ontouchstart = () => { pressTimer = setTimeout(() => { hideAllMenus(); document.getElementById(`menu-${idx}`).style.display = 'flex'; }, 700); };
                    div.onmouseup = div.ontouchend = () => clearTimeout(pressTimer);
                    grid.appendChild(div);
                });
            }
        };

        // --- LOGICA SCANNER ---
        window.startScanner = () => {
            document.getElementById('scanResultCard').style.display = 'none';
            document.getElementById('reader').style.display = 'block';
            if(!html5QrCode) html5QrCode = new Html5Qrcode("reader");
            html5QrCode.start({ facingMode: "environment" }, { fps: 20, qrbox: 250 }, async (decodedText) => {
                html5QrCode.stop();
                processProduct(decodedText);
            });
        };

        async function processProduct(barcode) {
            document.getElementById('reader').style.display = 'none';
            const card = document.getElementById('scanResultCard');
            card.style.display = 'block';
            document.getElementById('resTitle').innerText = "Ricerca...";
            
            try {
                const res = await fetch(`https://it.openfoodfacts.org/api/v0/product/${barcode}.json`);
                const data = await res.json();
                let prod = { 
                    name: "Prodotto Generico", 
                    img: "https://via.placeholder.com/100?text=ðŸ“¦",
                    barcode: barcode,
                    brand: ""
                };

                if(data.status === 1) {
                    prod.name = data.product.product_name || prod.name;
                    prod.img = data.product.image_url || prod.img;
                    prod.brand = data.product.brands || "";
                }

                document.getElementById('resTitle').innerText = prod.name;
                document.getElementById('resImg').src = prod.img;
                
                const q = encodeURIComponent(prod.name + " " + prod.brand);
                window.currentScan = prod;
                
                // Link Portali
                document.getElementById('btnAmz').onclick = () => window.open(`https://www.amazon.it/s?k=${q}`, '_blank');
                document.getElementById('btnGgl').onclick = () => window.open(`https://www.google.com/search?tbm=shop&q=${q}`, '_blank');
                document.getElementById('btnEby').onclick = () => window.open(`https://www.ebay.it/sch/i.html?_nkw=${q}`, '_blank');
                document.getElementById('btnTpz').onclick = () => window.open(`https://www.trovaprezzi.it/search?libera=${q}`, '_blank');

            } catch(e) { alert("Errore di rete"); }
        }

        window.saveShopping = async () => {
            const price = document.getElementById('shopPrice').value;
            const shop = document.getElementById('shopName').value;
            if(!price || !shop) { alert("Inserisci prezzo e negozio"); return; }

            const item = {
                ...window.currentScan,
                price: price,
                shop: shop,
                date: new Date().toLocaleDateString()
            };

            userData.myShopping.unshift(item);
            await syncCloud();
            alert("Salvato in Mia Spesa!");
            document.getElementById('shopPrice').value = "";
            document.getElementById('shopName').value = "";
            changeTab('spesa');
        };

        // --- FINE LOGICA SCANNER ---

        window.toggleSheet = () => {
            document.getElementById('bottomSheet').classList.toggle('open');
            document.getElementById('sheetOverlay').classList.toggle('active');
        };

        window.changeTab = (tab, el) => { 
            currentTab = tab; 
            document.querySelectorAll('.tab-item').forEach(i => i.classList.remove('active')); 
            if(el) el.classList.add('active'); 
            else {
                // Se attivato da codice (es dopo salvataggio), illumina l'icona corretta
                const tabs = document.querySelectorAll('.tab-item');
                tabs.forEach(t => { if(t.innerText.toLowerCase().includes(tab)) t.classList.add('active'); });
            }
            
            document.getElementById('bottomSheet').classList.remove('open');
            document.getElementById('sheetOverlay').classList.remove('active');
            
            if(html5QrCode && tab !== 'scanme') {
                try { html5QrCode.stop(); } catch(e){}
            }
            render(); 
        };

        window.askDelete = (index, type) => {
            event.stopPropagation(); hideAllMenus();
            document.getElementById('deleteOverlay').style.display = 'flex';
            document.getElementById('confirmDelete').onclick = async () => {
                if(type === 'work') userData.myWork.splice(index, 1); 
                else if(type === 'spesa') userData.myShopping.splice(index, 1);
                else userData.myLinks.splice(index, 1);
                document.getElementById('deleteOverlay').style.display = 'none';
                render(); await syncCloud();
            };
        };

        window.hideAllMenus = () => document.querySelectorAll('.context-menu').forEach(m => m.style.display = 'none');
        window.openAddModal = () => { editIndex = null; audioBase64 = null; document.getElementById('addModal').style.display = 'block'; };
        window.closeModal = () => document.getElementById('addModal').style.display = 'none';
        window.toggleFields = () => { 
            const isLink = document.getElementById('typeSelector').value === 'link'; 
            document.getElementById('linkFields').style.display = isLink ? 'block' : 'none'; 
            document.getElementById('workFields').style.display = isLink ? 'none' : 'block'; 
        };
        window.saveData = async () => {
            const type = document.getElementById('typeSelector').value;
            if(type === 'link') {
                const name = document.getElementById('siteName').value; let url = document.getElementById('siteUrl').value; const cat = document.getElementById('siteCategory').value;
                if(name && url) {
                    const item = { title: name, url: url, category: cat };
                    if(editIndex !== null) userData.myLinks[editIndex] = item; else userData.myLinks.push(item);
                }
            } else {
                const work = { client: document.getElementById('workClient').value, note: document.getElementById('workNote').value, hours: document.getElementById('workHours').value, date: document.getElementById('workDate').value, audio: audioBase64 };
                if(work.client) { if(editIndex !== null) userData.myWork[editIndex] = work; else userData.myWork.unshift(work); }
            }
            closeModal(); render(); await syncCloud();
        };
    </script>

    <style>
        :root { --primary: #007AFF; --bg: #f2f2f7; --work: #FF9500; --danger: #FF3B30; --success: #34C759; }
        body, html { margin: 0; padding: 0; font-family: -apple-system, sans-serif; background: var(--bg); height: 100%; overflow: hidden; }
        #welcomeScreen { position: fixed; inset: 0; background: #007AFF; display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .login-card { background: white; padding: 40px 30px; border-radius: 30px; text-align: center; width: 85%; max-width: 320px; }
        .login-input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 12px; border: 1px solid #ddd; font-size: 16px; box-sizing: border-box; }
        
        #mainApp { display: none; height: 100%; flex-direction: column; }
        .header { background: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; }
        .header img { height: 35px; }

        .content { flex: 1; overflow-y: auto; padding: 15px 15px 140px 15px; }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        .app-icon { display: flex; flex-direction: column; align-items: center; position: relative; }
        .icon-box { width: 60px; height: 60px; border-radius: 15px; background: white; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .icon-box img, .icon-box svg { width: 35px; height: 35px; }
        .app-name { font-size: 11px; margin-top: 6px; color: #333; text-align: center; font-weight: 500; }
        
        .work-card { background: white; padding: 15px; border-radius: 18px; margin-bottom: 10px; border-left: 5px solid var(--work); display: flex; justify-content: space-between; align-items: center; }
        .trash-btn svg { width: 20px; fill: var(--danger); }

        .tab-bar { position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.95); backdrop-filter: blur(15px); display: flex; padding: 10px 0 30px 0; border-top: 1px solid #ddd; justify-content: space-around; z-index: 2000; }
        .tab-item { display: flex; flex-direction: column; align-items: center; color: #8e8e93; font-size: 10px; flex: 1; cursor: pointer; }
        .tab-item.active { color: var(--primary); }
        .tab-item svg { width: 24px; height: 24px; fill: currentColor; margin-bottom: 4px; }
        
        .bottom-sheet { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-radius: 20px 20px 0 0; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 1500; transform: translateY(100%); transition: transform 0.3s ease-out; }
        .bottom-sheet.open { transform: translateY(-70px); }
        .sheet-handle { width: 40px; height: 5px; background: #ddd; border-radius: 5px; margin: 12px auto; }
        .sheet-content { padding: 10px 20px 40px 20px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        .sheet-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.3); display: none; z-index: 1400; }
        .sheet-overlay.active { display: block; }

        .add-btn { position: fixed; bottom: 100px; right: 20px; width: 60px; height: 60px; background: var(--primary); color: white; border-radius: 50%; border: none; font-size: 35px; z-index: 999; }
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 25px; border-radius: 25px; width: 85%; max-width: 320px; z-index: 3000; }
        .btn-action { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 12px; font-weight: bold; width: 100%; margin-top: 10px; }
        
        /* Stili Scanner */
        #reader { width: 100%; border-radius: 20px; overflow: hidden; }
        .shop-btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .shop-btn { padding: 10px; border: none; border-radius: 10px; color: white; font-weight: bold; font-size: 12px; }
    </style>
</head>
<body onclick="hideAllMenus()">

    <div id="welcomeScreen">
        <div class="login-card">
            <img src="logo.png" style="width:120px; margin-bottom:20px;">
            <input type="email" id="email" class="login-input" placeholder="Email">
            <input type="password" id="passInput" class="login-input" placeholder="Password">
            <button class="btn-action" onclick="handleAuth()">ACCEDI</button>
        </div>
    </div>

    <div id="mainApp">
        <div class="header">
            <img src="logo.png">
            <div onclick="logout()" style="color:var(--danger); font-size:14px; font-weight:bold">Esci</div>
        </div>

        <div id="searchBarContainer" style="padding:10px 15px; background:white; display:none;">
            <input type="text" class="search-input" style="width:100%; padding:10px; border-radius:10px; border:1px solid #ddd;" placeholder="Cerca..." oninput="searchTerm=this.value.toLowerCase(); render();">
        </div>

        <div class="content">
            <div class="grid" id="appGrid"></div>
            <div id="workContainer" style="display:none"></div>
            <div id="shoppingContainer" style="display:none"></div>
            
            <div id="scannerView" style="display:none">
                <div id="reader"></div>
                <div id="scanResultCard" style="display:none; background:white; padding:20px; border-radius:20px; margin-top:15px; text-align:center;">
                    <img id="resImg" style="width:100px; height:100px; object-fit:contain;">
                    <h3 id="resTitle" style="margin:10px 0;"></h3>
                    
                    <p style="font-size:12px; color:gray;">Cerca prezzo online:</p>
                    <div class="shop-btn-grid">
                        <button id="btnAmz" class="shop-btn" style="background:#FF9900">Amazon</button>
                        <button id="btnGgl" class="shop-btn" style="background:#4285F4">Google</button>
                        <button id="btnEby" class="shop-btn" style="background:#0064D2">eBay</button>
                        <button id="btnTpz" class="shop-btn" style="background:#E6000e">Trovaprezzi</button>
                    </div>

                    <div style="background:#f9f9f9; padding:15px; border-radius:15px;">
                        <input type="number" id="shopPrice" class="login-input" placeholder="Prezzo pagato â‚¬">
                        <input type="text" id="shopName" class="login-input" placeholder="Nome Negozio (es. Tigros)">
                        <button class="btn-action" onclick="saveShopping()">SALVA NEI DOCUMENTI</button>
                    </div>
                    <button onclick="startScanner()" style="background:none; border:none; color:var(--primary); margin-top:15px; font-weight:bold;">SCANNERIZZA NUOVO PRODOTTO</button>
                </div>
            </div>
        </div>

        <button class="add-btn" onclick="openAddModal()">+</button>

        <div id="sheetOverlay" class="sheet-overlay" onclick="toggleSheet()"></div>

        <div id="bottomSheet" class="bottom-sheet">
            <div class="sheet-handle"></div>
            <div class="sheet-content">
                <div class="tab-item" onclick="changeTab('lavoro', this)">
                    <svg viewBox="0 0 24 24"><path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-8 0h-4V4h4v2z"/></svg>
                    <span class="app-name">Lavoro</span>
                </div>
                <div class="tab-item" onclick="changeTab('scanme', this)">
                    <svg viewBox="0 0 24 24"><path d="M4 4h7V2H4c-1.1 0-2 .9-2 2v7h2V4zm6 9l-4 5h12l-3-4-2.03 2.71L10 13zm7-11h-7v2h7v7h2V4c0-1.1-.9-2-2-2zm2 18h-2v7h-7v2h7c1.1 0 2-.9 2-2v-7zM4 13H2v7c0 1.1.9 2 2 2h7v-2H4v-7z"/></svg>
                    <span class="app-name">ScanMe</span>
                </div>
                <div class="tab-item" onclick="changeTab('spesa', this)">
                    <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
                    <span class="app-name">Mia Spesa</span>
                </div>
            </div>
        </div>

        <div class="tab-bar">
            <div class="tab-item active" onclick="changeTab('tutti', this)">
                <svg viewBox="0 0 24 24"><path d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/></svg>
                <span>Tutti</span>
            </div>
            <div class="tab-item" onclick="changeTab('web', this)">
                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                <span>Web</span>
            </div>
            <div class="tab-item" onclick="changeTab('social', this)">
                <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                <span>Social</span>
            </div>
            <div class="tab-item" onclick="changeTab('contatti', this)">
                <svg viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
                <span>Contatti</span>
            </div>
            <div class="tab-item" onclick="toggleSheet()">
                <svg viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
                <span>Altro</span>
            </div>
        </div>
    </div>

    <div class="modal" id="addModal" style="box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
        <select id="typeSelector" onchange="toggleFields()" class="login-input">
            <option value="link">Link / Social / Contatto</option>
            <option value="lavoro">Lavoro (Ore / Note)</option>
        </select>
        <div id="linkFields">
            <input type="text" id="siteName" class="login-input" placeholder="Nome">
            <input type="text" id="siteUrl" class="login-input" placeholder="URL o Numero">
            <select id="siteCategory" class="login-input">
                <option value="web">Sito Web</option>
                <option value="social">Social Network</option>
                <option value="whatsapp">WhatsApp</option>
                <option value="contatti">Chiamata</option>
            </select>
        </div>
        <div id="workFields" style="display:none">
            <input type="text" id="workClient" class="login-input" placeholder="Cliente">
            <input type="text" id="workNote" class="login-input" placeholder="Note">
            <input type="number" id="workHours" class="login-input" placeholder="Ore">
            <input type="date" id="workDate" class="login-input" required>
        </div>
        <button class="btn-action" onclick="saveData()">SALVA</button>
        <button onclick="closeModal()" style="background:none; border:none; color:gray; width:100%; margin-top:15px;">Chiudi</button>
    </div>

    <div id="deleteOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:4000; align-items:center; justify-content:center;">
        <div class="login-card" style="padding:30px;">
            <p>Eliminare questo elemento?</p>
            <button class="btn-action" style="background:var(--danger)" id="confirmDelete">ELIMINA</button>
            <button onclick="document.getElementById('deleteOverlay').style.display='none'" style="background:none; border:none; color:gray; width:100%; margin-top:10px;">Annulla</button>
        </div>
    </div>

</body>
</html>
